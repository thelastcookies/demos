<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
<!--     <script src="@Url.Content("~/Content/Js/jquery-1.9.1.js")"></script>
    <link href="@Url.Content("~/Content/Style/Page/CustomTrend.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/Trend/css/zTreeStyle/zTreeStyle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/My97DatePicker_Gray/skin/WdatePicker.css")" rel="stylesheet" type="text/css" />


    <script src="@Url.Content("~/Content/HighChart/highcharts.js")"></script>
    <script src="@Url.Content("~/Content/My97DatePicker_Gray/WdatePicker.js")"></script>
    <script src="@Url.Content("~/Content/Trend/js/jquery.ztree.core-3.5.js")"></script>
    <script src="@Url.Content("~/Content/Trend/js/jquery.ztree.excheck-3.5.js")"></script>
    <script src="@Url.Content("~/Content/Trend/js/PrintExcel.js")"></script> -->
    <script type="text/javascript" src = "../../js-repo/jquery/jquery-3.1.1.js"></script>
    <script type="text/javascript">
        $(function () {
            //
            // 记录输入框中的光标位置
            var anchorNode = $("#dis_output_formula")[0];
            var anchorOffset = 0;
            // 创建 DOM 范围来操纵 DOM
            var insertRange = document.createRange();
            /* 输入按钮点击事件
             *
             *
             */
            $(".dis_input_btn").on ("click", function (event) {
                // console.log (anchorOffset);
                // 根据点击的按钮来获取要输入的内容
                var textContentInput = this.id.substr(this.id.length - 1);
                // 如果点击的是 + - × ÷ ( ) 的话，再结果前后加空格
                if (Array.prototype.slice.apply(event.target.classList).indexOf("dis_input_btn_punc") > 0) {
                    textContentInput = " " + textContentInput + " ";
                }
                // 准备向公式区输入
                textContentDOM = $("#dis_output_formula");
                // 获取公式区中的 HTML 文档
                var textContent = textContentDOM.html();
                // 
                // var arrTemp = textContent.split("");
                // arrTemp.splice(anchorOffset, 0, textContentInput);
                // anchorOffset += textContentInput.length;
                // // 
                // var textContentOutPut = arrTemp.join("");
                // console.log (textContentOutPut);
                textContent += textContentInput;

                textContentDOM.html(textContent);
                // outputFormulaGetFocus();
            });

            /* 点击数据源列表向公式框中添加数据源节点
             */
            $("#station_list_content tr td").on ("click", function (event) {
                // 获取当前点击事件
                var target = event.target;
                // 初始化输出内容
                var output = "<span class = 'dis_output_source' contenteditable = 'false'>#";
                // 判断如果点击的是 数据源 这一列，则直接获取其数据源编号，如果不是，则顺着 tr 找到此行的数据源编号。
                if (target.className != "station_list_content_data") {
                    output += target.parentElement.firstElementChild.innerText;
                }
                else {
                    output += target.innerText;
                }
                // 准备向公式区输入
                textContentDOM = $("#dis_output_formula");
                // 获取公式区里原有的内容，存储在 textContent 中。
                // var textContent = textContentDOM.html();
                // 向 textContent 里注入点击到的数据源编号，并封闭 span。
                output += "</span> ";
                // 调用 insertIntoOutputFormula 方法来插入内容
                insertIntoOutputFormula (output);

                

                // 将增加新数据源编号的 textContent 放入公式区。
                // textContentDOM.html(textContent);
                // outputFormulaGetFocus();
            });

            $("#dis_output_formula").on("blur", function (event) {
                // 当公式区失去焦点的时候，获取失焦前的光标所在位置，之后的内容要从其中插入。
                anchorNode = window.getSelection().anchorNode;
                anchorOffset = window.getSelection().anchorOffset;
                // 判断原来光标所在位置是否为数据源编号，如果是，则将内容插入在他们后面
                //
                //

                // // 使用 DOM Range 来进行内容插入
                // insertRange.setStart(anchorNode, anchorOffset);
                // // 初始化插入节点
                // var nodeTemp = $("<span class = 'dis_output_source' contenteditable = 'false'>#032000143</span>");
                // // 使用 DOM Range 的方法 insertNode 向原来的光标所在处插入内容
                // insertRange.insertNode (nodeTemp[0]);
                // console.log(window.getSelection());
                // console.log ($("#dis_output_formula")[0]);
                // console.log (anchorNode, anchorOffset);
                // console.log (insertRange);

            });

            $("#dis_output_formula").on("change", function () {
                // console.log ("change");
            });

            function outputFormulaGetFocus () {
                // $("#dis_output_formula").focus();
            }


            // 该方法旨在实现：向 anchorNode，anchorOffset 所指定的位置插入内容
            // 参数：insertNodeString 要插入内容的 HTML 字符串
            function insertIntoOutputFormula (insertNodeString) {
                // 使用 DOM Range 来进行内容插入，通过全局变量 anchorNode，anchorOffset 来确定插入位置。
                insertRange.setStart(anchorNode, anchorOffset);
                // 将插入节点的 HTML 字符串转化为节点
                var nodeTemp = $(insertNodeString);
                // 使用 DOM Range 的方法 insertNode 向原来的光标所在处插入内容
                insertRange.insertNode (nodeTemp[0]);
                console.log (nodeTemp);
                nodeTemp = undefined;
                console.log (anchorNode, anchorOffset);
                console.log (insertRange);
            }
        });
    </script>

    <style scoped="scoped">
        .reports {
            width: 265px;
            height: 247px;
            padding:;
            background: url('../../content/web/calendar/reports.png') transparent no-repeat 0 0;
            margin:;
        }
    </style>
    <style>
        * {
            /*box-sizing: border-box;*/

        }
    	body {
            /*color: white;*/
            /*background: rgb(9, 13, 33);*/
            -webkit-user-select:none;
            -moz-user-select:none;
            -ms-user-select:none;
            user-select:none;
        }
    	div.formula_dialog {
    		width: 800px;
            height: 465px;
            /*background-color: rgb(13, 20, 46);*/
    		/*background-color: #eee;*/
            border: 1px solid #e5e5e5;
            box-sizing: border-box;
            padding-left: 8px;
            padding-top: 15px;
    	}
        div#dv_formula_show {
            display: none;
        }
        div.dialog_top {
            width: 800px;
            margin:;
            font-size: 18px;
            padding-left: 25px;
            margin-bottom: 25px;
            /*height: 100px;*/
        }
        .dialog_name {
        }
        div#formula_list_div {
            width: 100%;
            height: 80%;
        }
        /*table.list {
            border: 1px solid #e5e5e5;
            width: 100%;
            line-height: 60px;
            text-align: center;
            font-size: 12px;
        }

        tr.table_title {
            height: 33px;
            background-color: #aaa;
        }
        th.table_title_name {
        }
        th.table_title_formula {
        }
        th.table_title_operate {
        }*/

    	button.dv_operate_btn {
            width: 52px;
            height: 25px;
            border: #aaa 1px solid;
            border-radius: 50px;
            font-size: 12px;
    		display: inline-block;
            background-color: #fff;
    	}
        button.dv_operate_btn:active {
            color: #aaa;
        }
        button#dv_operate_btn_cancel {
            margin:;
        }

        div#dv_formula_modify {
            /*display: none;*/
            padding:;
        }
        div#dialog_top {
            font-size: 18px;
        }
        div#dialog_body {
            width: 100%;
            height: 80%;
            font-size:0;

        }
        div.dialog_body_part {
            /*background-color: #bbb;*/
            display: inline-block;
            vertical-align: top;
            margin-right: 10px;
        }
        div.dialog_body_part:last-of-type {
            margin-right: 0;
        }
        div.dialog_body_line {
            margin-bottom: 10px;
        }
        div#dis_title {
            width: 180px;
            height: 26px;
            font-size: 12px;
            border: 1px solid #e5e5e5;
            padding:;
            border-radius: 5px;
            margin-bottom: 10px;
            box-sizing: border-box;
            line-height: 26px;
            text-align: center;
            /*display: inline-block;*/
        }
        div#dis_formula {
            width: 180px;
            height: 130px;
            border: 1px solid #e5e5e5;
            margin:;
            padding:;
            border-radius: 5px;
            box-sizing: border-box;
            /*display: inline-block;*/

        }
        div#dis_formula_intro {
            width: 230px;
            height: 165px;
            border: 1px solid #e5e5e5;
            padding:;
            border-radius: 5px;
            box-sizing: border-box;
        }
        div#dis_input {
            width: 350px;
            /*height: 380px;*/
            font-size: 0;
        }
        div.dis_input_line {
        }
        div.dis_input_line:last-of-type button.dis_input_btn {
            margin-bottom: 0px;
        }
        button.dis_input_btn {
            width: 80px;
            height: 35px;
            display: inline-block;
            border: 1px solid #e5e5e5;
            font-size: 15px;
            border-radius: 5px;
            margin-right: 10px;
            margin-bottom: 8px;
            box-sizing: border-box;
            line-height: 33px;
            text-align: center;
            background-color: #fff;
        }
        button.dis_input_btn:last-of-type {
            margin-right: 0;
        }
        button.dis_input_btn_sm {
            width: 35px;
        }
        /* 表格样式 开始 */
        div#dis_list {
            width: 420px;
            height: 165px;
            box-sizing: border-box;
            border: solid 1px #e5e5e5;

        }
        table.station_list {
            width: 100%;
            padding: 0;
            font-size: 12px;
            text-align: center;
            line-height: 28px;
        }
        div.station_list_content_container {
            height: 126px;
            box-sizing: border-box;
            overflow: auto;
            margin-top: 1px;
        }
        table.station_list_title {
            border: 0;
            background-color: #e5e5e5;
        }
        table#station_list_content {
            border: 0;
            cursor: pointer;
        }
        table#station_list_content tr:nth-child(2n) {
            border: 0;
            background-color: #e5e5e5;
        }
        th.station_list_title_data,
        td.station_list_content_data {
            width: 30%;
        }
        th.station_list_title_name,
        td.station_list_content_name {
            width: 50%;
        }
        th.station_list_title_value,
        td.station_list_content_value {
            width: 20%;
        }

        /* 表格样式 结束 */

        /* 最后一块的输出公式和计算结果 开始 */
        div#dis_output {
            width: 350px;
            height: 165px;
            border: solid 1px #e5e5e5;
            box-sizing: border-box;
            border-radius: 5px;
            font-size: 12px;
        }
        div#dis_output_formula {
            width: 100%;
            height: 130px;
            box-sizing: border-box;
            padding: 15px 10px;
            line-height: 20px;
            overflow: auto;
            -webkit-user-select:text;
            -moz-user-select:text;
            -ms-user-select:text;
            user-select:text;
        }
        span.dis_output_source {
            background-color: #ddd;
        }
        /*      
        span.dis_output_source:after {
            content: "×";
            position: relative;
            top: -10px;
        }
        */
        div#dis_output_result {
            width: 100%;
            height: 30px;
            border-top: solid 1px #e5e5e5;
            box-sizing: border-box;
            padding: 0 10px;
            line-height: 30px;
        }
        /* 最后一块的输出公式和计算结果 结束 */

        /* dialog_bottom 样式 底部按钮等 开始 */
        div.dialog_bottom {
            padding-left: 600px;
        }
        button.dis_operate_btn {
            width: 53px;
            height: 27px;
            border: solid 1px #e5e5e5;
            background-color: #fff;
            box-sizing: border-box;
            font-size: 12px;
            padding: 0;
            text-align: center;
            line-height: 25px;
            border-radius: 5px;
            margin-left: 18px;
        }
        /* dialog_bottom 样式 底部按钮等 结束 */

    </style>
<!--     <script type="text/javascript" language="javascript">
        var setting = {
            view: {
                selectedMulti: false
            },
            check: {
                enable: true
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                beforeCheck: beforeCheck,
                onCheck: onCheck,
                onClick: onClick
            }
        };
        function beforeCheck(treeId, treeNode) {
            return (treeNode.doCheck !== false);
        }
        var point = '', name = '', pid = '', checkVal = 0;;

        function onCheck(e, treeId, treeNode) {
            point = '';
            name = '';
            pid = '';
            var treeObj = $.fn.zTree.getZTreeObj("tree");
            var nodes = treeObj.getCheckedNodes(true);

            for (var i = 0; i < nodes.length; i++) {

                if (treeNode.checked == true) {
                    point += nodes[i].nodeID + ',';
                    name += nodes[i].name + ',';
                    pid += nodes[i].pid + ',';
                }
            }

            if (name == '' || name == undefined) {
                point = '', name = '', pid = '';
                for (var i = 0; i < nodes.length; i++) {
                    point += nodes[i].nodeID + ',';
                    name += nodes[i].name + ',';
                    pid += nodes[i].pid + ',';
                }
                name = name.substring(0, name.length - 1);
                point = point.substring(0, point.length - 1);
                pid = pid.substring(0, pid.length - 1);

                name = name.replace('undefined', '');
                point = point.replace('undefined', '');
                pid = pid.replace('undefined', '');
                if (name == '') {
                    //alert('请选择测点');
                    $("#dv_Formula_left_list").html("");
                    $("#dv_table").html('');
                    $("#container").html('');
                }
                else {
                    
                    ShowDiv('dv_Mask', 'dv_fade', point, name);
                    $("#dv_table").hide();
                    $("#container").show();
                }
            } else {
                name = name.substring(0, name.length - 1);
                point = point.substring(0, point.length - 1);
                pid = pid.substring(0, pid.length - 1);
                ShowDiv('dv_Mask', 'dv_fade', point, name);
                $("#dv_table").hide();
                $("#container").show();
            }
        }
        function onClick(event, treeId, treeNode, clickFlag) {

        }

        var LoadBody = function () {
            $("#sp_title").text('公式名称');
            $("#start").text('开始');
            $("#end").text('结束');
            $("#jiange").text('间隔');
            $("#btn_chart_show").html('查询');
            $("#btn_save").html('保存');
            $("#btn_print").html('打印');
            $("#btn_Formula").html('公式');

            LoadTree();
        }

        function getHeight() {
            var newHeight = $(document.body).height();
            var mainPage = $(window.parent.document).find("#mainPage");
            var main = $(window.parent.document).find("#main");
            mainPage.height(newHeight);
            main.height(newHeight);
        }
        function setLoaction() {
            var wd = $('.right_bottom').width();
            var h = $(window).height();
            //$('#content').css('height', h - 60 + 'px');
            $('#container,#dv_table').css({ 'height': h - 62 + 'px', 'width': wd - 3 + 'px' });

            $('#dv_left').css('height', h - 28 + 'px');
        }
        $(function () {
            //window.parent.window.gotoScrollTop();

            setLoaction();//自适应

            Data();//时间框赋值
            LoadData();//初始化数据
            LoadBody();//初始化树

            getSrceenWH();//获取页面宽度，高度
            SearchTree();

            $("#btn_save").click(function () {
                var box = 300;
                var th = $(window).height() / 2.5 - 75;
                var rw = $(window).width() / 2 - 150;
                $("#dv_Save_body").animate({ top: th, opacity: 'show', width: 300, height: 150, left: rw }, 500);
                $('#dialogBg').fadeIn();
            });
            $("#btn_line").css("background-image", "url(../../Content/img/Map/map_trend_click.png)");
            $("#btn_table").css("background-image", "url(../../Content/img/Map/map_table.png)");
            $("#btn_line").click(function () {
                $("#dv_table").hide();
                $("#container").show();
                $("#btn_line").css("background-image", "url(../../Content/img/Map/map_trend_click.png)");
                $("#btn_table").css("background-image", "url(../../Content/img/Map/map_table.png)");
            });
            $("#btn_table").click(function () {
                $("#dv_table").show();
                $("#container").hide();
                $("#btn_line").css("background-image", "url(../../Content/img/Map/map_trend.png)");
                $("#btn_table").css("background-image", "url(../../Content/img/Map/map_table_click.png)");
            });

            $("#btn_chart_show").click(function () {    //查询
                var ts = '清先选择测点在进行查询!';

                var treeObj = $.fn.zTree.getZTreeObj("tree");
                var nodes = treeObj.getCheckedNodes(true);

                point = '', name = '', pid = '';

                for (var i = 0; i < nodes.length; i++) {
                    point += nodes[i].nodeID + ',';
                    name += nodes[i].name + ',';
                    pid += nodes[i].pid + ',';
                }

                name = name.substring(0, name.length - 1);
                point = point.substring(0, point.length - 1);
                pid = pid.substring(0, pid.length - 1);

                if (point != '') {
                    $.post('@Url.Content("~/History/LineShow")', { point: point, name: name, num: 3, count: $("#txt_jiange").val(), st: $("#sDate").val(), et: $("#eDate").val(), type: $("#sec_jiange").val(), fConnect: $("#fla_connect").val(), fTitle: $("#fla_title").val() }, function (data) {
                        GetLine(data);
                        GetTable(data.tb);
                        CloseDiv('dv_Load_body', 'dv_Save');
                        $("#dv_Formula_left_list").html(data.formula);
                    }, 'json');
                } else
                {
                    $("#dv_Formula_left_list").html("");
                    alert(ts);
                }
                    
            });

            $("#btn_back").click(function () {
                window.location.href = "@Url.Content('~/History/CustomTrend')";
            });

            $("#btn_print").click(function () {
                $.post('@Url.Content("~/History/Print")', {}, function (data) {
                    alert(data);
                }, 'json');
            });

            /*公式删除*/
            $("#btn_Del").click(function () {
                checkVal = 1;
                $.post('@Url.Content("~/History/GetFormula")', { query: 'del', fTitle: $("#fla_title").val(), fConnect: $("#fla_connect").val(), title: $("#txtTitle").val(), name: $("#txtFormula").val() }, function (data) {
                    $("#dv_list").html(data.formulaList);
                    $("#fla_title").val(data.formulaTitle);
                    $("#fla_connect").val(data.formulaConnect);
                }, 'json');
            });

            $("#btn_Formula").click(function () {

                $("#text_search").text('Formula List');
                $("#dv_Operate").show();
                $("#dv_Formula_right").show();
                $("#dv_Formula_left_add").hide();
                $("#dv_Formula_right_add").hide();

                var box = 300;
                var th = $(window).height() / 2 - 180;
                var rw = $(window).width() / 2 - 300;
                $("#dv_Formula").animate({ top: th, opacity: 'show', width: 600, height: 360, left: rw }, 500);
                $('#dialogBg').fadeIn();
            });

            /*公式添加*/
            $("#btn_Add").click(function () {

                //清空已选数据
                $("#txtFormula").val('');
                $("#txtTitle").val('');

                $("#text_search").text('Formula Calculator');

                $("#dv_Operate").hide();
                $("#dv_Formula_right").hide();
                $("#dv_Formula_left_add").show();
                $("#dv_Formula_right_add").show();

                typeBtn = 'add';

                //CloseDiv('dv_Formula', '');
            });

            /*公式 添加  编辑  不操作数据库*/
            $("#btn_Save_Formula").click(function () {
                if (typeBtn == 'edit') {
                    /*编辑公式*/

                    $.post('@Url.Content("~/History/GetFormula")', { query: 'edit', fTitle: $("#fla_title").val(), fConnect: $("#fla_connect").val(), oleTitle: $("#dis_title").val(), oldFormula: $("#dis_formula").val(), title: $("#txtTitle").val(), name: $("#txtFormula").val() }, function (data) {
                        //GetLine(data);
                        $("#dv_list").html(data.formulaList);

                        $("#fla_title").val(data.formulaTitle);
                        $("#fla_connect").val(data.formulaConnect);

                        $("#dv_Operate").show();
                        $("#dv_Formula_right").show();
                        $("#dv_Formula_left_add").hide();
                        $("#dv_Formula_right_add").hide();

                        $("#txtTitle").val('');
                    }, 'json');


                } else if (typeBtn == 'add') {
                    /*增加公式不操作数据库*/

                    $("#dis_con").val($("#txtFormula").val() + "~" + $("#dis_con").val());
                    $("#dis_name").val($("#txtTitle").val() + "~" + $("#dis_name").val());

                    $.post('@Url.Content("~/History/GetFormula")', { query: 'add', title: $("#txtTitle").val(), name: $("#txtFormula").val(), fTitle: $("#fla_title").val(), fConnect: $("#fla_connect").val() }, function (data) {
                        //GetLine(data);
                        $("#dv_list").html(data.formulaList);

                        $("#fla_title").val(data.formulaTitle);
                        $("#fla_connect").val(data.formulaConnect);

                        $("#dv_Operate").show();
                        $("#dv_Formula_right").show();
                        $("#dv_Formula_left_add").hide();
                        $("#dv_Formula_right_add").hide();
                    }, 'json');
                }
            });

            $("#btn_Save_Model").click(function () {

                var treeObj = $.fn.zTree.getZTreeObj("tree");
                var nodes = treeObj.getCheckedNodes(true);
                var v = "";
                for (var i = 0; i < nodes.length; i++) {
                    v += nodes[i].id + ",";
                }

                $.post('@Url.Content("~/History/AddModel")', { id: v, name: $("#txtName").val(), formulaName: $("#fla_title").val(), formulaConnect: $("#fla_connect").val() }, function (data) {

                    if (data.result = true) {
                        alert('模板保存成功!');
                        CloseDiv('dv_Save_body', 'dv_Save');
                    }
                    else
                        alert('模板保存失败!');
                }, 'json');
            });
            //RegChartRightClickEvents();
        });

        function SearchTree() {
            $("#btnSearch").click(function () {

                point = '';
                name = '';
                pid = '';
                $("#dv_table").html('');
                $("#container").html('');


                /* $.get('@Url.Content("~/File/Tree.json")', {}, function (data) {
                    var zNodes = eval(data.tree);
                    $.fn.zTree.init($("#tree"), setting, zNodes);
                }, 'json'); 
                */
                $.post('@Url.Content("~/History/GetSearchTree")', { key: $("#txtSearch").val() }, function (data) {
                    var zNodes = eval(data.tree);
                    $.fn.zTree.init($("#tree"), setting, zNodes);
                }, 'json');
            });

        }

        function updatepoint() {
            $.post('@Url.Content("~/History/Updatetree")', {  }, function (data) {
                $.get('@Url.Content("~/File/Tree.json")', {}, function (data) {
                    var zNodes = eval(data.tree);
                    var zTree = $.fn.zTree.init($("#tree"), setting, zNodes);
                    
                }, 'json');
            }, 'json');
        }


        function LoadTree() {
            $.ajax({
                type:"GET",
                url: '@Url.Content("~/File/Tree.json")',
            cache:false,
            dataType:"json",
            success:function (data){
                var zNodes = eval(data.tree);
                var zTree = $.fn.zTree.init($("#tree"), setting, zNodes);
                var id = GetCookie('id');           //模板编码
                $.post('@Url.Content("~/History/GetZtree")', { id: id }, function (data) {
                    var _nodesplit = data.tree.split(',');
                    var treeObj = $.fn.zTree.getZTreeObj("tree");
                    for (var i = 0; i < _nodesplit.length; i++) {
                        treeObj.checkNode(treeObj.getNodeByParam("id", _nodesplit[i], null), true, true);
                    }

                }, 'json');
            }
        });
        }


        function LoadData() {

            var id = GetCookie('id');           //模板编码
            var judge = GetCookie('yaxis');     //是否是多Y轴
            var max = GetCookie("max");         //最大值
            var min = GetCookie("min");         //最小值
            var y = GetCookie("y");             //Y轴是否自动增长

            $.post('@Url.Content("~/History/GetZtreeListInit")', { id: id, judge: judge, max: max, min: min, y: y }, function (data) {

                $("#dv_Formula_left_list").html(data.formula);
                $("#dv_list").html(data.formulaList);

                $("#fla_title").val(data.formulaTitle);
                $("#fla_connect").val(data.formulaConnect);

                GetLine(data);
                GetTable(data.tb);
            }, 'json');
        }

        function GetLineY(list) {
            $('#container').highcharts({
                chart: {
                    type: 'spline'
                },
                title: {
                    text: 'Trend Curve Chart'//标题
                },
                subtitle: {
                    text: ''//副标题
                },
                xAxis: {
                    type: 'datetime',
                    labels: {
                        overflow: 'justify'
                    }
                },
                yAxis: {
                    title: {
                        text: ''//Y轴标题
                    },
                    //min: '',
                    //max: '',
                    minorGridLineWidth: 0,
                    gridLineWidth: 0,
                    alternateGridColor: null
                },
                tooltip: {
                    valueSuffix: ' m/s', shared: true
                },
                plotOptions: {
                    spline: {
                        lineWidth: 0.4,
                        states: {
                            hover: {
                                lineWidth: 0.5
                            }
                        },
                        marker: {
                            enabled: false
                        },
                        pointInterval: 3600000, // one hour
                        pointStart: Date.UTC(2009, 9, 6, 0, 0, 0)
                    }
                },
                series: list.list,
                navigation: {
                    menuItemStyle: {
                        fontSize: '10px'
                    }
                }
            });
        }

        //趋势显示
        function GetLine(list) {
            var highchartsOptions = Highcharts.setOptions(Highcharts.theme);
            if (list != null) {
                chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container',
                        type: 'spline',
                        zoomType: 'x',
                        events: {
                            click: function () {
                                ////清空已选数据
                                //$("#txtFormula").val('');

                                //var box = 300;
                                //var th = $(window).height() / 2.5 - 150;
                                //var rw = $(window).width() / 2 - 200;
                                //$("#dv_Formula").animate({ top: $(window).height() / 2, opacity: 'hide', width: 0, height: 0, left: $(window).width() / 2 }, 0);
                                //$("#dv_Formula").animate({ top: th, opacity: 'show', width: 600, height: 360, left: rw }, 500);
                                //$('#dialogBg').fadeIn();
                            }
                        }
                    },
                    title: {
                        text: list.title
                    },
                    exporting: {
                        enabled: false //用来设置是否显示‘打印’,'导出'等功能按钮，不设置时默认为显示
                    },
                    xAxis: {
                        type: 'datetime',
                        labels: {
                            formatter: function () {
                                return Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.value);
                            }
                        }
                    },
                    colors: ['#058DC7', '#50B432', '#ED561B', '#DDDF00', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4'],
                    yAxis: list.yAxis,
                    tooltip: {
                        xDateFormat: '<b>' + '%Y-%m-%d %H:%M:%S' + '</b>',
                        crosshairs: {
                            width: 2,
                            color: 'red'
                        },
                        shared: true
                    },
                    plotOptions: {
                        spline: {
                            lineWidth: 2,
                            states: {
                                hover: {
                                    lineWidth: 2.5
                                }
                            },
                            marker: {
                                enabled: false
                            }
                        }
                    },
                    //exporting: {
                    //    enabled: false
                    //},
                    exporting:
                    {
                        buttons: {    //配置按钮选项
                            printButton: {    //配置打印按钮
                                width: 50,
                                symbolSize: 20,
                                borderWidth: 2,
                                borderRadius: 0,
                                hoverBorderColor: 'red',
                                height: 30,
                                symbolX: 25,
                                symbolY: 15,
                                x: -200,
                                y: 20
                            },
                            exportButton: {    //配置导出按钮
                                width: 50,
                                symbolSize: 20,
                                borderWidth: 2,
                                borderRadius: 0,
                                hoverBorderColor: 'red',
                                height: 30,
                                symbolX: 25,
                                symbolY: 15,
                                x: -150,
                                y: 20
                            },
                        },
                        filename: '52wulian.org',//导出的文件名
                        type: 'image/png',//导出的文件类型
                        width: 800    //导出的文件宽度
                    },
                    credits: {
                        enabled: false
                    },
                    series: list.list
                });
            }
            else {
                chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container',
                        type: 'spline'
                    },
                    title: {
                        text: '趋势呈现数据图'
                    },
                    xAxis: {
                        type: 'datetime'
                    },
                    exporting: {
                        enabled: false //用来设置是否显示‘打印’,'导出'等功能按钮，不设置时默认为显示
                    },
                    yAxis: {
                        title: {
                            text: ''
                        },
                        min: 0
                    }
                });
            }
        }

        function GetTable(tb) {
            $("#dv_table").html(tb);
        }


        function GetCookie(objName) {//获取指定名称的cookie的值
            var arrStr = document.cookie.split("; ");
            for (var i = 0; i < arrStr.length; i++) {
                var temp = arrStr[i].split("=");
                if (temp[0] == objName) return unescape(temp[1]);
            }
        }

        //弹出隐藏层
        function ShowDiv(show_div, bg_div, point, name) {
            var box = 300;
            var th = $(window).height() / 2 - 150;
            var rw = $(window).width() / 2 - 200;
            $("#dv_Load_body").animate({ top: th, opacity: 'show', width: 400, height: 300, left: rw }, 500);
            $('#dialogBg').fadeIn();
            if ($("#eDate").val() != '' && $("#sDate").val() != '') {
                if (point != '') {
                    $.post('@Url.Content("~/History/LineShow")', { point: point, name: name, num: 3, count: $("#txt_jiange").val(), st: $("#sDate").val(), et: $("#eDate").val(), type: $("#sec_jiange").val(), fConnect: $("#fla_connect").val(), fTitle: $("#fla_title").val() }, function (data) {
                        GetLine(data);
                        GetTable(data.tb);
                        CloseDiv('dv_Load_body', 'dv_Save');
                        $("#dv_Formula_left_list").html(data.formula);
                    }, 'json');
                }
            }
            else
                alert('查询时间不能为空!');
        };
        //关闭弹出层
        function CloseDiv(show_div, bg_div) {
            $('#dialogBg').fadeOut();
            w = $(window).width() / 2;
            h = $(window).height() / 2;
            $("#" + show_div).animate({ top: h, opacity: 'hide', width: 0, height: 0, left: w }, 500);

            $("#txtFormula").val('');
            /*关闭弹出层时  重新绘制趋势*/

            var treeObj = $.fn.zTree.getZTreeObj("tree");
            var nodes = treeObj.getCheckedNodes(true);
            var b = '';
            for (var i = 0; i < nodes.length; i++) {
                b += nodes[i].name + ",";
            }

            if (show_div == 'dv_Formula') {
                if (checkVal == 0)
                    $.post('@Url.Content("~/History/Redreaw")', { name: $("#fla_connect").val(), fTitle: $("#fla_title").val(), title: '', sTime: $("#sDate").val(), jg: $("#txt_jiange").val() }, function (data) {
                        checkVal = 0;
                        GetLine(data);
                        GetTable(data.tb);
                    }, 'json');
                else                     /*当删除公式时，请求该方法*/
                    $.post('@Url.Content("~/History/Redreaw")', { name: $("#fla_connect").val(), fTitle: $("#fla_title").val(), title: $("#txtTitle").val(), sTime: $("#sDate").val(), jg: $("#txt_jiange").val(), point: b }, function (data) {
                        checkVal = 0;
                        GetLine(data);
                        GetTable(data.tb);
                    }, 'json');
            }
        };
        var w, h, className;
        function getSrceenWH() {
            w = $(window).width();
            h = $(window).height();
            $('#dialogBg').width(w).height(h);
        }

        window.onresize = function () {
            getSrceenWH();
        }
        $(window).resize();

        function Data() {

            var data = new Date();
            var year = data.getFullYear(); //获取完整的年份(4位,1970-????)
            var month = data.getMonth() + 1;  //获取当前月份(0-11,0代表1月)
            var day = data.getDate();

            $("#sDate").val(year + '-' + month + '-' + day + ' 0:00:00');
            $("#eDate").val(year + '-' + month + '-' + day + ' ' + data.getHours() + ':00:00');
        }

        function RegChartRightClickEvents() {
            document.oncontextmenu = false;
            ////图表容器的右键鼠标事件
            //$("#container").bind("mouseup", function (oEvent) {
            //    if (!oEvent) oEvent = window.event;
            //    if (oEvent.button == 2) {

            //        //var box = 300;
            //        //var th = $(window).height() / 2.5 - 150;
            //        //var rw = $(window).width() / 2 - 200;
            //        //$("#dv_Formula").animate({ top: $(window).height() / 2, opacity: 'hide', width: 0, height: 0, left: $(window).width() / 2 }, 0);
            //        //$("#dv_Formula").animate({ top: th, opacity: 'show', width: 400, height: 300, left: rw }, 500);
            //        //$('#dialogBg').fadeIn();

            //    }
            //});
        }
        function addValue(val) {
            alert(val);
            $("#txtFormula").val($("#txtFormula").val() + "'" + val + "'");
        }
        /*公式删除*/
        function DelFormula(obj, id, formula, title, cid) {

            $("#txtTitle").val(title);

            formula = formula.replace(/~/g, "'");
            $("#txtFormula").val(formula);

            $("#dis_id").val(cid);              /*模板编码*/
            $("#dis_title").val(title);         /*公式标题*/
            $("#dis_formula").val(formula);     /*公式内容*/


            checkVal = 1;
            $.post('@Url.Content("~/History/GetFormula")', { query: 'del', fTitle: $("#fla_title").val(), fConnect: $("#fla_connect").val(), title: $("#txtTitle").val(), name: $("#txtFormula").val() }, function (data) {
                $("#dv_list").html(data.formulaList);
                $("#fla_title").val(data.formulaTitle);
                $("#fla_connect").val(data.formulaConnect);
            }, 'json');
        }
        function EditFormula(obj, id, formula, title, cid) {
            $("#txtTitle").val(title);

            formula = formula.replace(/~/g, "'");
            $("#txtFormula").val(formula);

            $("#dis_id").val(cid);              /*模板编码*/
            $("#dis_title").val(title);         /*公式标题*/
            $("#dis_formula").val(formula);     /*公式内容*/
        }
        var typeBtn = '';
        function EditFormulaDbl(id, formula, title, cid) {
            typeBtn = 'edit';
            /*ID 为模板ID*/
            $("#dv_Operate").hide();
            $("#dv_Formula_right").hide();
            $("#dv_Formula_left_add").show();
            $("#dv_Formula_right_add").show();

            $("#txtTitle").val(title);

            formula = formula.replace(/~/g, "'");
            $("#txtFormula").val(formula);

            $("#dis_id").val(cid);              /*模板编码*/
            $("#dis_title").val(title);         /*公式标题*/
            $("#dis_formula").val(formula);     /*公式内容*/
        }

        function mouseClick(obj) {
            clearClickClass();
            if (obj.className == "tr_over_1" || obj.className == "tr_1")
                obj.className = "tr_foucs_1";
            else if (obj.className == "tr_over_2" || obj.className == "tr_2")
                obj.className = "tr_foucs_2";
        }
        function clearClickClass() {
            $('table').find('tr').each(function () {
                if ($(this).attr('class') == "tr_foucs_1")
                    $(this).attr('class', 'tr_1');
                else if ($(this).attr('class') == "tr_foucs_2")
                    $(this).attr('class', 'tr_2');
            });
        }

    </script> -->
<!--     <script type="text/javascript">
    	$(function () {
    		$("#dv_operate_btn_add").click (function () {

    		});
    	});
    </script> -->
</head>
<body>
    <div id = "dialogBg"></div>

    <div id = "dv_formula_show" class="formula_dialog">
    	<!-- 公示列表展示 -->
        <div class="dialog_top">
            <div class="dialog_name">公式列表</div>
            <div class="btn_close" onclick="CloseDiv('dv_Formula', '')"></div>
        </div>
        <!--公式列表 -->
            <!--<div id="btn_Del" class="button_save" style=" align-content:center;">Del</div> -->
            <!--<div id="btn_Edit"  class="button_save" style=" align-content:center;" >Edit</div> -->
            <div id = "formula_list_div">
            	<table id = "formula_list" class = "list" cellspacing="0">
            		<tr class = "table_title">
            			<th class = "table_title_name">公式名称</th>
            			<th class = "table_title_formula">公式内容</th>
            			<th class = "table_title_operate">操作</th>
            		</tr>
            		<tr>
            			<td>公式一</td>
            			<td>a+b-c</td>
            			<td></td>
            		</tr>
            		<tr>
            			<td>公式二</td>
            			<td>a+b-c</td>
            			<td></td>
            		</tr>
            	</table>
            </div>
        <div id="dv_operate" class = "dialog_bottom">
            <button class = "dv_operate_btn" id = "dv_operate_btn_cancel">取消</button>
            <button class = "dv_operate_btn" id = "dv_operate_btn_add">新建</button>
        </div>
    </div>

    <div id = "dv_formula_modify" class = "formula_dialog">
    	<!-- 公式列表新建与修改 -->
    	<div class="dialog_top">
            <span class="dialog_name">参数集合</span>
            <div class="btn_close" onclick=""></div>
        </div>
        <div id = "dialog_body">
            <div class = "dialog_body_line">
                <div class = "dialog_body_part">
            	    <div id = "dis_title">函数及操作符信息</div>
            	    <div id = "dis_formula"></div>
                </div>
                <div class = "dialog_body_part">
            	    <div id = "dis_formula_intro"></div>
                </div>
            	<div id = "dis_input" class = "dialog_body_part">
                    <div class = "dis_input_line">
            	       <button class = "dis_input_btn" id = "dis_input_btn_7">7</button>
            	       <button class = "dis_input_btn" id = "dis_input_btn_8">8</button>
            	       <button class = "dis_input_btn" id = "dis_input_btn_9">9</button>
            	       <button class = "dis_input_btn dis_input_btn_punc" id = "dis_input_btn_÷">÷</button>
                    </div>
                    <div class = "dis_input_line">
            	       <button class = "dis_input_btn" id = "dis_input_btn_4">4</button>
            	       <button class = "dis_input_btn" id = "dis_input_btn_5">5</button>
            	       <button class = "dis_input_btn" id = "dis_input_btn_6">6</button>
            	       <button class = "dis_input_btn dis_input_btn_punc" id = "dis_input_btn_×">×</button>
                    </div>
                    <div class = "dis_input_line">
            	        <button class = "dis_input_btn" id = "dis_input_btn_1">1</button>
            	        <button class = "dis_input_btn" id = "dis_input_btn_2">2</button>
            	        <button class = "dis_input_btn" id = "dis_input_btn_3">3</button>
            	        <button class = "dis_input_btn dis_input_btn_punc" id = "dis_input_btn_+">+</button>
                    </div>
                    <div class = "dis_input_line">
            	        <button class = "dis_input_btn" id = "dis_input_btn_0">0</button>
            	        <button class = "dis_input_btn" id = "dis_input_btn_.">.</button>
            	        <button class = "dis_input_btn dis_input_btn_sm dis_input_btn_punc" id = "dis_input_btn_(">(</button>
            	        <button class = "dis_input_btn dis_input_btn_sm dis_input_btn_punc" id = "dis_input_btn_)">)</button>
            	        <button class = "dis_input_btn dis_input_btn_punc" id = "dis_input_btn_-">-</button>
                    </div>
            	</div>
            </div>
            <div class = "dialog_body_line">
                <div id = "dis_list" class = "dialog_body_part">
                    <table class = "station_list station_list_title">
                        <tr>
                            <th class = "station_list_title_data">数据源</th>
                            <th class = "station_list_title_name">名称</th>
                            <th class = "station_list_title_value">值</th>
                        </tr>
                    </table>
                    <div class = "station_list_content_container">
                    	<table class = "station_list" id = "station_list_content">
                    		<tr>
                    			<td class = "station_list_content_data">1111111111</td>
                    			<td class = "station_list_content_name">逆变器N13交流电压</td>
                    			<td class = "station_list_content_value">404.4</td>
                    		</tr>
                    		<tr>
                    			<td class = "station_list_content_data">2222222222</td>
                    			<td class = "station_list_content_name">逆变器N13交流电流</td>
                    			<td class = "station_list_content_value">8.7</td>
                    		</tr>
                            <tr>
                                <td class = "station_list_content_data">3333333333</td>
                                <td class = "station_list_content_name">逆变器N13交流电流</td>
                                <td class = "station_list_content_value">8.7</td>
                            </tr>
                            <tr>
                                <td class = "station_list_content_data">4444444444</td>
                                <td class = "station_list_content_name">逆变器N13交流电流</td>
                                <td class = "station_list_content_value">8.7</td>
                            </tr>
                            <tr>
                                <td class = "station_list_content_data">5555555555</td>
                                <td class = "station_list_content_name">逆变器N13交流电流</td>
                                <td class = "station_list_content_value">8.7</td>
                            </tr>
                    	</table>
                    </div>
                </div>
                <div id = "dis_output" class = "dialog_body_part">
                	<div id = "dis_output_formula" contenteditable = "true"></div>
                	<div id = "dis_output_result">输出预览：<span id = "dis_output_result_cal">6093.66</span></div>
                </div>
            </div>
        </div>
        <div class = "dialog_bottom">
        	<button class = "dis_operate_btn" id = "dis_operate_btn_cancel">取消</button>
            <button class = "dis_operate_btn" id = "dis_operate_btn_save">保存</button>
        </div>

    </div>
</body>
</html>
<!--
            <span id="sp_title" class="toolbar_text">&nbsp;&nbsp;公式名称&nbsp;:</span>&nbsp;&nbsp;&nbsp;<input id="txtTitle" class="frame_input" value="" style="width:314px; height:23px;" />
            <textarea id="txtFormula" class="frame_input"></textarea>
            <input id="dis_name" style="display:none;" />
            <input id="dis_con" style="display:none;" />
            <input id="dis_id" style="display:none;" />
            <input id="dis_title" style="display:none;" />
            <input id="dis_formula" style="display:none;" />

            <input id="fla_title" style="display:none;" />
            <input id="fla_connect" style="display:none;" />
            <div id="btn_Save_Formula" class="button_save" style="align-content:center; margin:;

        -->
