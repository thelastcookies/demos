<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
<!--     <script src="@Url.Content("~/Content/Js/jquery-1.9.1.js")"></script>
    <link href="@Url.Content("~/Content/Style/Page/CustomTrend.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/Trend/css/zTreeStyle/zTreeStyle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/My97DatePicker_Gray/skin/WdatePicker.css")" rel="stylesheet" type="text/css" />


    <script src="@Url.Content("~/Content/HighChart/highcharts.js")"></script>
    <script src="@Url.Content("~/Content/My97DatePicker_Gray/WdatePicker.js")"></script>
    <script src="@Url.Content("~/Content/Trend/js/jquery.ztree.core-3.5.js")"></script>
    <script src="@Url.Content("~/Content/Trend/js/jquery.ztree.excheck-3.5.js")"></script>
    <script src="@Url.Content("~/Content/Trend/js/PrintExcel.js")"></script> -->
    <script type="text/javascript" src = "../../../code-repo/jquery/jquery-3.1.1.js"></script>
    <script type="text/javascript" src = "../../../code-repo/mathjs/math.js"></script>
    <!-- <link rel = "stylesheet" href = "../../../code-repo/animatecss/animate.css"> -->

    <script type="text/javascript">
        $(function () {
            //
            // 记录输入框中的光标位置
            var anchorNode = $("#dis_output_formula")[0];
            // 自动聚焦
            anchorNode.focus();
            var anchorOffset = 0;

            // 创建 DOM 范围来操纵 DOM
            var insertRange = document.createRange();

            // 数学公式信息
            var mathFormula = {
                "abs(x)": "返回给定数值的绝对值，即不带符号的数值.", 
                "cos(x)": "返回给定角度的余弦值.", 
                "exp(x)": "返回 e 的 n 次方.", 
                "floor(x)": "将数字向下舍入到最接近的整数或最接近的指定基数的倍数.", 
                "log(x)": "根据给定底数返回数字的对数.", 
                "max(value1, value2, ...)": "返回给定所有值的最大值", 
                "min(value1, value2, ...)": "返回给定所有值的最小值", 
                "sin(x)": "返回给定角度的正弦值.", 
                "tan(x)": "返回给定角度的正切值."
            };

            // 数据源信息
            var dataSource = {};

            // 当前正在操作的公式 id
            var formulaID = "";

            /* 输入按钮点击事件
             */
            $(".dis_input_btn").on ("click", function (event) {
                // console.log (anchorOffset);
                // 根据点击的按钮来获取要输入的内容
                var output = this.id.substr(this.id.length - 1);
                // 如果点击的是 + - × ÷ ( ) 的话，再结果前后加空格
                if (Array.prototype.slice.apply(event.target.classList).indexOf("dis_input_btn_punc") > 0) {
                    output = " " + output + " ";
                }
                insertIntoOutputFormula (output);
                // 自动聚焦
                // $("#dis_output_formula").focus();
            });

            /* 点击数据源列表向公式框中添加数据源节点
             */
            // $("#station_list_content tr td").on ("click", function (event) {

            $("#station_list_content").on ("click", function (event) {
                // 获取当前点击事件
                var target = event.target;
                // 初始化输出内容
                // var output = "<span class = 'dis_output_source' contenteditable = 'false'>#";
                var output = " ";
                // 判断如果点击的是 数据源 这一列，则直接获取其数据源编号，如果不是，则顺着 tr 找到此行的数据源编号。
                if (target.className != "station_list_content_name") {
                    output += target.parentElement.children[1].innerText;
                }
                else {
                    output += target.innerText;
                }
                output += " ";
                // 准备向公式显示区输入
                formulaContentDOM = $("#dis_output_formula");
                // 调用 insertIntoOutputFormula 方法来插入内容
                insertIntoOutputFormula (output);
            });

            // 在每次输入框失去焦点时，更新 anchorNode 和 anchorOffset 的值，便于下次插入时从光标位置插入。
            $("#dis_output_formula").on("blur", function (event) {
                // 当公式显示区失去焦点的时候，获取失焦前的光标所在位置，之后的内容要从其中插入。
                anchorNode = window.getSelection().anchorNode;
                anchorOffset = window.getSelection().anchorOffset;
            });

            // 根据光标位置插入内容，同时更新公式显示区显示和公式显示区 value
            // 参数：
            // outputFormula 公式显示区显示内容
            // outputValue 公式显示区 value
            function insertIntoOutputFormula (outputFormula, outputValue) {
                // 准备向公式显示区输入
                formulaContentNode = $("#dis_output_formula");
                // 获取公式显示区中的 HTML 文档字符串
                var formulaContentDOM = formulaContentNode.text();
                var formulaContentData = formulaContentNode.data("value");
                // 对字符串进行处理，从 anchorOffset 处将字符串切开
                var strTemp1 = formulaContentDOM.slice(0, anchorOffset);
                var strTemp2 = formulaContentDOM.slice(anchorOffset);
                // 更新 anchorOffset 的值
                anchorOffset += outputFormula.length;
                // 拼装输出的 HTML 字符串
                outputFormula = strTemp1 + outputFormula + strTemp2;
                // 将拼装好的字符串写入公式显示区
                formulaContentNode.text(outputFormula);
                // console.log (outputFormula);
            }

            // 点击数学公式列表，将数学公式填入输入框
            $("#math_formula tr td").on ("click", function() {
                // console.log (this.innerText);
                insertIntoOutputFormula (this.innerText);
            });

            // 数学公式介绍区域内容
            // var mathFormulaIntro = "";
            // var target = "";

            // 在数学公式列表里悬浮或者点击时，显示相关公式的介绍
            $("#math_formula").on ("mouseover click", function (event) {
                target = event.target;
                if (target.nodeName == "TD")  {
                    $("#dis_formula_intro")[0].innerText = mathFormula[target.innerText];
                    // if (event.type == "click") {
                    //     mathFormulaIntro = mathFormula[target.innerText];
                    // }
                }
            });
            // .on ("mouseout", function (event) {
            //     $("#dis_formula_intro")[0].innerText = mathFormula[target.innerText];
            // });

            // 监听公式显示区的变化，并将计算结果输出到预览区
            $("#dis_output_formula").bind('DOMSubtreeModified', function(e) {
                var formulaText = $(e.target).text();
                // var formulaTextNoNbsp = formulaText.replace();
                // 正则表达式说明，要匹配的结果中
                // 1. 不能是纯数字，防止对正常的数字计算进行干扰
                // 2. 不能是运算符
                // 3. 不能是 sin, cos, tan 等特殊运算符
                // 4. 应该是一串包含汉字，可能包含数字字母空格的字符串
                var formulaTextRep = formulaText.replace(/(?![0-9a-z \+\-\*\/\(\)\.]+)([\u4e00-\u9fa5\w ]+)/g, function (match) {
                    // 过滤掉结尾的空格
                    var matchNoNbsp = match.replace(/ *$/g, "");
                    if (dataSource[matchNoNbsp])
                        return dataSource[matchNoNbsp].value;
                });

                try {
                    var formulaTextRepNoNbsp = formulaTextRep.replace(/\s/g, "");
                    var calResult = math.format(math.eval(formulaTextRepNoNbsp), 7);
                    // console.log (calResult);

                    if (calResult === "undefined")
                        $("#dis_output_result_cal").text ("NaN");
                    else
                        $("#dis_output_result_cal").text (calResult);
                } catch (e) {
                    // console.log (e.name, e.message);
                    $("#dis_output_result_cal").text ("NaN");

                }
            }); 

            // 各个按钮的点击事件
            // 公式列表页的 新建 按钮
            $("#dv_operate_btn_add").on ("click", function () {
                formulaID = Date.now().toString();
                $('#dv_formula_show').hide();
                $('#dv_formula_modify').show();
            });

            // 公式列表页的 修改 删除 按钮
            $("#formula_list_content").on ("click", function (event) {
                var target = event.target;
                // 根据点击的单元行获取公式的 id
                formulaID = target.parentElement.parentElement.firstElementChild.innerText;

                // 公式编辑界面
                if (target.className == "formula_list_content_modify") {
                    $("#dis_output_formula")[0].innerText = getFromFormulaList(dataFormula, formulaID, "desc");
                    $("#confirm_formula_title").val(getFromFormulaList(dataFormula, formulaID, "title"));
                    $("#dv_formula_show").hide();
                    $("#dv_formula_modify").show();
                }
                else if (target.className == "formula_list_content_del"){
                    delInForlumaList(dataFormula, formulaID);
                    updateFormulaList(dataFormula);
                }
            });

            // 公式列表页的 取消 按钮
            // 公式列表页的 X 按钮
            $("#dv_operate_btn_cancel, #dv_formula_show_close").on ("click", function () {
                $('#dv_formula_show').hide();
            });

            // 公式编辑页的 保存 按钮
            $("#dis_operate_btn_save").on ("click", function () {
                var temp = $("#dis_output_formula");
                $("#dialog_confirm_body_formula")[0].innerText = temp[0].innerText;
                $("#dialogBg_confirm").show();
                $("#dv_formula_confirm").show();
                $("#confirm_formula_title").focus();
            });
            
            // 公式编辑页的 取消 按钮
            // 公式编辑页的 X 按钮
            $("#dis_operate_btn_cancel, #dv_formula_modify_close").on ("click", function () {
                $('#dv_formula_modify').hide();
                $('#dv_formula_show').show();
            });

            // 公式确认页的 确认 按钮
            //
            $("#confirm_btn_save").on ("click", function() {
                var formulaDesc = $("#dialog_confirm_body_formula")[0].innerText;
                var formulaTextRep = formulaDesc.replace(/(?![0-9a-z \+\-\*\/\(\)\.]+)([\u4e00-\u9fa5\w ]+)/g, function (match) {
                    // 过滤掉结尾的空格
                    var matchNoNbsp = match.replace(/ *$/g, "");
                    if (dataSource[matchNoNbsp])
                        return "#" + dataSource[matchNoNbsp].data;
                });
                var formulaTextRepNoNbsp = formulaTextRep.replace(/\s/g, "");

                // 拼装 ajax 数据 data
                var data = {"title": $("#confirm_formula_title").val(), "connect": formulaTextRepNoNbsp, "desc": formulaDesc, "id": formulaID, "mid": ""};



                for (var i = 0, len = dataFormula.length; i < len; i++) {
                    // 状态为编辑
                    if (dataFormula[i].id == formulaID) {
                        setFormulaList (dataFormula, formulaID, "title", data.title);
                        setFormulaList (dataFormula, formulaID, "connect", data.connect);
                        setFormulaList (dataFormula, formulaID, "desc", data.desc);
                        updateFormulaList(dataFormula);

                        // $.ajax ({});
                        // 隐藏确认、编辑对话框以及背景
                        $("#dialogBg_confirm").hide();
                        $("#dv_formula_confirm").hide();
                        $("#dv_formula_modify").hide();
                        // 清空输入
                        $("#dis_output_formula")[0].innerText = "";
                        $("#confirm_formula_title").val("");
                        // 显示公式列表界面
                        $("#dv_formula_show").show();
                        return ;
                    }
                }
                // 在已存在的公式列表中没有找到该 id 的相关信息，所以状态为新增
                // 将新建的公式插入公式列表信息中
                dataFormula.push(data);
                // 使用 方法更新公式列表页
                updateFormulaList(dataFormula);

                // $.ajax({
                //     url: '@Url.Content("~/History/AddFormula")',
                //     data: data,
                //     type: 'post',
                //     dataType: 'json',
                //     timeout: 10000,
                //     success: function (data) {
                    // ajax 请求返回之后
                        // 隐藏确认、编辑对话框以及背景
                        $("#dialogBg_confirm").hide();
                        $("#dv_formula_confirm").hide();
                        $("#dv_formula_modify").hide();
                        // 清空输入
                        $("#dis_output_formula")[0].innerText = "";
                        $("#confirm_formula_title").val("");
                        // 显示公式列表界面
                        $("#dv_formula_show").show();
                            

            //          },
            //          error: function (XMLHttpRequset, textStatus, errorThrown) {
            //          }
            //      });
                console.log (data);
            });

            // 公式确认页的 取消 按钮
            //
            $("#confirm_btn_cancel").on ("click", function () {
                $("#dialogBg_confirm").hide();
                $("#dv_formula_confirm").hide();
            });


            // 动态载入数据源信息
            var tableData = [
            {
                "data": "0320000143",
                "name": "逆变器 N13交流电压",
                "value": "404.4"
            },
            {
                "data": "0320000144",
                "name": "逆变器 N13交流电流",
                "value": "8.7"
            },
            {
                "data": "0320000145",
                "name": "逆变器 N14交流电压",
                "value": "398.1"
            },
            {
                "data": "0320000146",
                "name": "逆变器 N14交流电流",
                "value": "9.0"
            },
            {
                "data": "0320000147",
                "name": "逆变器 N15交流电压",
                "value": "400.2"
            },
            {
                "data": "0320000148",
                "name": "逆变器 N15交流电流",
                "value": "9.2"
            }
            ];
            
            var formulaTable = '';
            for (var i = 0, len = tableData.length; i < len; i++) {
                formulaTable += '<tr><td class = "station_list_content_data">' + tableData[i].data + '</td><td class = "station_list_content_name">' + tableData[i].name + '</td><td class = "station_list_content_value">' + tableData[i].value + '</td></tr>';
                var tempObj = {"data": tableData[i].data, "value": tableData[i].value};
                dataSource[tableData[i].name] = tempObj;
            }
            // console.log ("formulaTable", formulaTable);
            console.log ("dataSource", dataSource);

            $("#station_list_content").html(formulaTable);

            // 动态载入公式信息
            var dataFormula = [
            {
                "title": "test1",
                "connect": "1+#0320000143",
                "desc": "1 + 逆变器 N13交流电压",
                "id": "1512009713471",
                "mid": ""
            },
            {
                "title": "test2",
                "connect": "#0320000143+#0320000144",
                "desc": "逆变器 N13交流电压 + 逆变器 N13交流电流",
                "id": "1512010473419",
                "mid": ""
            }];

            // 储存所有公式信息,加载公式
            updateFormulaList(dataFormula);

            // 根据公式信息 dataFormula 来刷新公式区
            function updateFormulaList (dataFormula) {
                var formulaListDiv = $("#formula_list_content");
                var formulaListHtml = "";

                for (var i = 0, len = dataFormula.length; i < len; i++) {
                    formulaListHtml += '<tr><td class="formula_list_content_id">' + dataFormula[i].id + '</td><td class="formula_list_content_name">' + dataFormula[i].title + '</td><td class="formula_list_content_formula">' + dataFormula[i].desc + '</td><td class="formula_list_content_operate"><span class = "formula_list_content_modify">编辑</span> <span class = "formula_list_content_del">删除</span></td></tr>';
                }
                formulaListDiv.html(formulaListHtml);
            }

            /** 根据公式 id 从公式信息 dataFormula 中获取 getSth 所指定的信息并返回
             *  formulaID 表示要操作的公式 id
             *  getSth 表示要取到的公式项
             */
            function getFromFormulaList (dataFormula, formulaID, getSth) {
                try {
                    for (var i = 0, len = dataFormula.length; i < len; i++) {
                        if (dataFormula[i].id == formulaID) {
                            return dataFormula[i][getSth];
                        }
                    }
                } catch (e) {
                    console.error ("获取公式信息指定参数错误", e.name);
                };
            }

            /** 根据公式 id 从公式信息 dataFormula 中获取 getSth 所指定的信息
             *  formulaID 表示要操作的公式 id
             *  setSth 表示要设置的公式项
             *  setValue 表示要设置的公式项的值
             */
            function setFormulaList (dataFormula, formulaID, setSth, setValue) {
                try {
                    for (var i = 0, len = dataFormula.length; i < len; i++) {
                        if (dataFormula[i].id == formulaID) {
                            dataFormula[i][setSth] = setValue;
                        }
                    }
                } catch (e) {
                    console.error ("设置公式信息指定参数错误", e.name);
                };
            }

            /** 根据公式 id 从公式信息 dataFormula 中删除相应公式项
             *  formulaID 表示要操作的公式 id
             *  返回被删除的公式项对象
             */
            function delInForlumaList (dataFormula, formulaID) {
                try {
                    for (var i = 0, len = dataFormula.length; i < len; i++) {
                        if (dataFormula[i].id == formulaID) {
                            return dataFormula.splice(i, 1);
                        }
                    }
                } catch (e) {
                    console.error ("找不到指定的公式项");
                }
            }

            // 下面是一些页面跳转的显示隐藏样式 
            // 从公式列表页跳转到公式编辑/新建页
            // 从公式编辑/新建也跳转到公式列表页
        });
    </script>

    <style scoped="scoped">
        .reports {
            width: 265px;
            height: 247px;
            padding:;
            background: url('../../content/web/calendar/reports.png') transparent no-repeat 0 0;
            margin:;
        }
    </style>
    <style>
        * {
            /*box-sizing: border-box;*/
        }
    	body {
            /*color: white;*/
            /*background: rgb(9, 13, 33);*/
            -webkit-user-select:none;
            -moz-user-select:none;
            -ms-user-select:none;
            user-select:none;
            width: 100%;
            height: 100%;

        }
        div#dv_formula {
            width: 800px;
            height: 465px;
            position: fixed;
            left: 50%;
            top: 50%;

            margin-left: -400px;
            margin-top: -232.5px;
        }
        div#dialogBg {

        }
        div#dialogBg_confirm {
            width: 100%;
            height: 100%;
            background-color: #000000;
            opacity: .3;
            filter: alpha(opacity=30);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10001;
            display: none;
        }
    	div.formula_dialog {
    		width: 800px;
            height: 465px;
            /*background-color: rgb(13, 20, 46);*/
    		/*background-color: #eee;*/
            border: 1px solid #e5e5e5;
            box-sizing: border-box;
            padding-left: 8px;
            padding-top: 15px;
    	}

        /* 页面的两大模块 开始*/
        div#dv_formula_show {
            /*display: none;*/
        }
        div#dv_formula_modify {
            display: none;
        }
        /* 页面的两大模块 结束*/

        /* 每个模块的 top，body，bottom div 开始*/
        div.dialog_top {
            width: 800px;
            margin:;
            font-size: 18px;
            padding-left: 25px;
            margin-bottom: 25px;
            /*height: 100px;*/
        }
        div.dialog_name {
            display: inline-block;
            vertical-align: top;
        }
        div.btn_close {
            width: 21px;
            height: 21px;
            background-image: url("./css/btn_close.png");
            display: inline-block;
            vertical-align: top;
            cursor: pointer;
            margin-left: 640px;
        }
        div.dialog_body {
            width: 100%;
            height: 80%;
            font-size:0;
        }
        /* 每个模块的 top，body，bottom div 结束*/
        /* dialog_bottom 样式 底部按钮等 开始 */
        div.dialog_bottom {
            padding-left: 600px;
        }
        button.dis_operate_btn {
            width: 53px;
            height: 27px;
            border: solid 1px #e5e5e5;
            background-color: #fff;
            box-sizing: border-box;
            font-size: 12px;
            padding: 0;
            text-align: center;
            line-height: 25px;
            border-radius: 5px;
            margin-left: 18px;
        }
        /* dialog_bottom 样式 底部按钮等 结束 */
        /* 每个模块的 top，body，bottom div 结束*/
        /* 以下为 dv_formula_show 界面的相关样式 */
        div#dv_formula_show {
            padding-right: 15px;
        }
        div#formula_list_div {
            width: 100%;
            height: 80%;
        }
        div#formula_list_container {
            margin-left: 7px;
            border: solid 1px #e5e5e5;
        }
        table.formula_list {
            width: 100%;
            padding: 0;
            font-size: 12px;
            text-align: center;
            line-height: 30px;
            border-collapse: collapse;
        }
        table#formula_list_title {
            border: 0;
            background-color: #e5e5e5;
        }
        div#formula_list_content_container {
            height: 310px;
            box-sizing: border-box;
            overflow: auto;
            margin-top: 1px;
        }
        table#formula_list_content {
            border: 0;
        }
        table#formula_list_content tr:nth-child(2n) {
            border: 0;
            background-color: #e5e5e5;
        }
        table#formula_list_content tr:last-child {
            border-bottom: 1px solid #e5e5e5;
        }
        td.formula_list_content_id {
            display: none;
        }
        th.formula_list_title_name,
        td.formula_list_content_name {
            width: 30%;
        }
        th.formula_list_title_formula,
        td.formula_list_content_formula {
            width: 50%;
        }
        th.formula_list_title_operate,
        td.formula_list_content_operate {
            width: 20%;
        }
        span.formula_list_content_modify,
        span.formula_list_content_del{
            cursor: pointer;
        }

        /* 以上为 dv_formula_show 界面的相关样式 */
        /* 以下为 dv_formula_modify 界面的相关样式 */
        /* dv_formula_modify 页面中 dialog_body 样式 开始*/
        div.dialog_body_line {
            margin-bottom: 10px;
        }
        div.dialog_body_part {
            /*background-color: #bbb;*/
            display: inline-block;
            vertical-align: top;
            margin-right: 10px;
        }
        div.dialog_body_part:last-of-type {
            margin-right: 0;
        }
        /* dv_formula_modify 页面中 dialog_body 样式 结束*/
        /* 数学公式列表 开始 */
        div#dis_title {
            width: 180px;
            height: 26px;
            font-size: 12px;
            border: 1px solid #e5e5e5;
            padding:;
            border-radius: 5px;
            margin-bottom: 10px;
            box-sizing: border-box;
            line-height: 26px;
            text-align: center;
            /*display: inline-block;*/
        }
        div#dis_formula {
            width: 180px;
            height: 130px;
            border: 1px solid #e5e5e5;
            margin:;
            padding: 5px;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 12px;
            overflow: auto;
            /*display: inline-block;*/
        }
        table#math_formula {
            width: 100%;
        }
        table#math_formula tr {
            cursor: pointer;
        }
        table#math_formula tr:hover {
            background-color: #e5e5e5;
        }
        /* 数学公式列表 结束 */
        /* 输入板样式 开始 */
        div#dis_formula_intro {
            width: 230px;
            height: 165px;
            border: 1px solid #e5e5e5;
            padding: 5px 10px;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 12px;
        }
        div#dis_input {
            width: 350px;
            /*height: 380px;*/
            font-size: 0;
        }
        div.dis_input_line {
        }
        div.dis_input_line:last-of-type button.dis_input_btn {
            margin-bottom: 0px;
        }
        button.dis_input_btn {
            width: 80px;
            height: 35px;
            display: inline-block;
            border: 1px solid #e5e5e5;
            font-size: 15px;
            border-radius: 5px;
            margin-right: 10px;
            margin-bottom: 8px;
            box-sizing: border-box;
            line-height: 33px;
            text-align: center;
            background-color: #fff;
        }
        button.dis_input_btn:last-of-type {
            margin-right: 0;
        }
        button.dis_input_btn_sm {
            width: 35px;
        }
        /* 输入板样式 结束 */
        /* 数据源列表样式 开始 */
        div#station_list_container {
            width: 420px;
            height: 165px;
            box-sizing: border-box;
            border: solid 1px #e5e5e5;
        }
        table.station_list {
            width: 100%;
            padding: 0;
            font-size: 12px;
            text-align: center;
            line-height: 30px;
            border-collapse: collapse;
        }
        table.station_list_title {
            border: 0;
            background-color: #e5e5e5;
        }        
        div.station_list_content_container {
            height: 126px;
            box-sizing: border-box;
            overflow: auto;
            margin-top: 1px;
        }
        table#station_list_content {
            border: 0;
            cursor: pointer;
        }
        table#station_list_content tr:nth-child(2n) {
            border: 0;
            background-color: #e5e5e5;
        }
        th.station_list_title_data,
        td.station_list_content_data {
            width: 30%;
        }
        th.station_list_title_name,
        td.station_list_content_name {
            width: 50%;
        }

        th.station_list_title_value,
        td.station_list_content_value {
            width: 20%;
        }
        /* 数据源列表样式 结束 */
        /* 公式显示区和结果预览 开始 */
        div#dis_output {
            width: 350px;
            height: 165px;
            border: solid 1px #e5e5e5;
            box-sizing: border-box;
            border-radius: 5px;
            font-size: 12px;
        }
        div#dis_output_formula {
            width: 100%;
            height: 130px;
            box-sizing: border-box;
            padding: 15px 10px;
            line-height: 20px;
            overflow: auto;
            -webkit-user-select:text;
            -moz-user-select:text;
            -ms-user-select:text;
            user-select:text;
        }
        span.dis_output_source {
            background-color: #ddd;
        }
        div#dis_output_result {
            width: 100%;
            height: 30px;
            border-top: solid 1px #e5e5e5;
            box-sizing: border-box;
            padding: 0 10px;
            line-height: 30px;
        }
        /* 公式显示区和结果预览 结束 */
        /* 点击保存之后的确认界面 开始 */
        div.dv_formula_confirm {
            width: 400px;
            height: 247.2px;
            border: solid 1px #e5e5e5;
            box-sizing: border-box;
            background-color: #fff;
            position: fixed;
            top: 50%;
            left: 50%;
            margin-left: -200px;
            margin-top: -123.6px;
            z-index: 10001;
            display: none;
        }
        div.dialog_confirm_top {
            padding: 15px 15px 0 25px;
            font-size: 18px;
            line-height: 18px;
            box-sizing: border-box;
        }
        div.dialog_confirm_body {
            height: 174.2px;
            box-sizing: border-box;
            padding: 15px;
        }
        div.dialog_confirm_body_name {
            height: 72.1px;
            box-sizing: border-box;
            padding: 5px;
        }
        div.dialog_confirm_body_name_title {
            font-size: 12px;
            line-height: 18px;
        }
        div.dialog_confirm_body_name_input {

        }
        input#confirm_formula_title {
            border: 0;            
            border-bottom: 1px solid #e5e5e5;
            width: 300px;
            height: 30px;
            margin: 5px 20px;
            font-size: 15px;
            line-height: 15px;
            padding: 1px 15px;
        }
        input#confirm_formula_title:focus {
            box-shadow: 1px;
            outline: none;
        }
        div.dialog_confirm_body_formula {
            height: 72.1px;
            box-sizing: border-box;
            font-size: 12px;
            line-height: 18px;
            border: solid 1px #e5e5e5;
            background-color: #efefef;
            padding: 15px;
            overflow-y: auto;
        }
        div.dialog_confirm_bottom {
            height: 40px;
            padding-left: 225px;
            box-sizing: border-box;

        }
        /* 点击保存之后的确认界面 结束 */
        /* 以上为 dv_formula_modify 界面的相关样式 */
    </style>

</head>
<body>
    <div id = "dialogBg"></div>
    <div id = "dialogBg_confirm"></div>
    <div id = "dv_formula">

        <div id = "dv_formula_show" class="formula_dialog">
    	   <!-- 公式列表展示 -->
            <div class="dialog_top">
                <div class="dialog_name">公式列表</div>
                <div class="btn_close" id = "dv_formula_show_close"></div>
            </div>
            <div class = "dialog_body">
                <div id = "formula_list_container">
                    <table id = "formula_list_title" class = "formula_list">
                    	<tr>
                    		<th class = "formula_list_title_name">公式名称</th>
                    		<th class = "formula_list_title_formula">公式内容</th>
                    		<th class = "formula_list_title_operate">操作</th>
                    	</tr>
                    </table>
                    <div id = "formula_list_content_container">
                        <table id = "formula_list_content" class = "formula_list">
                        </table>
                    </div>
                </div>
            </div>
            <div class = "dialog_bottom" id="dv_operate">
                <button class = "dis_operate_btn" id = "dv_operate_btn_cancel">取消</button>
                <button class = "dis_operate_btn" id = "dv_operate_btn_add">新建</button>
            </div>
        </div>
    
        <div id = "dv_formula_modify" class = "formula_dialog">
    	    <!-- 公式列表新建与修改 -->
    	    <div class="dialog_top">
                <span class="dialog_name">参数集合</span>
                <div class="btn_close" id = "dv_formula_modify_close"></div>
            </div>
            <div class = "dialog_body">
                <div class = "dialog_body_line">
                    <div class = "dialog_body_part">
                	    <div id = "dis_title">函数及操作符信息</div>
                	    <div id = "dis_formula">
                            <table id = "math_formula">
                                <tr>
                                    <td>abs(x)</td>
                                </tr>
                                <tr>
                                    <td>cos(x)</td>
                                </tr>
                                <tr>
                                    <td>exp(x)</td>
                                </tr>
                                <tr>
                                    <td>floor(x)</td>
                                </tr>
                                <tr>
                                    <td>log(x)</td>
                                </tr>
                                <tr>
                                    <td>max(value1, value2, ...)</td>
                                </tr>
                                <tr>
                                    <td>min(value1, value2, ...)</td>
                                </tr>
                                <tr>
                                    <td>sin(x)</td>
                                </tr>
                                <tr>
                                    <td>tan(x)</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class = "dialog_body_part">
                	    <div id = "dis_formula_intro"></div>
                    </div>
                	<div id = "dis_input" class = "dialog_body_part">
                        <div class = "dis_input_line">
                	       <button class = "dis_input_btn" id = "dis_input_btn_7">7</button>
                	       <button class = "dis_input_btn" id = "dis_input_btn_8">8</button>
                	       <button class = "dis_input_btn" id = "dis_input_btn_9">9</button>
                	       <button class = "dis_input_btn dis_input_btn_punc" id = "dis_input_btn_/">÷</button>
                        </div>
                        <div class = "dis_input_line">
                	       <button class = "dis_input_btn" id = "dis_input_btn_4">4</button>
                	       <button class = "dis_input_btn" id = "dis_input_btn_5">5</button>
                	       <button class = "dis_input_btn" id = "dis_input_btn_6">6</button>
                	       <button class = "dis_input_btn dis_input_btn_punc" id = "dis_input_btn_*">×</button>
                        </div>
                        <div class = "dis_input_line">
                	        <button class = "dis_input_btn" id = "dis_input_btn_1">1</button>
                	        <button class = "dis_input_btn" id = "dis_input_btn_2">2</button>
                	        <button class = "dis_input_btn" id = "dis_input_btn_3">3</button>
                	        <button class = "dis_input_btn dis_input_btn_punc" id = "dis_input_btn_+">+</button>
                        </div>
                        <div class = "dis_input_line">
                	        <button class = "dis_input_btn" id = "dis_input_btn_0">0</button>
                	        <button class = "dis_input_btn" id = "dis_input_btn_.">.</button>
                	        <button class = "dis_input_btn dis_input_btn_sm dis_input_btn_punc" id = "dis_input_btn_(">(</button>
                	        <button class = "dis_input_btn dis_input_btn_sm dis_input_btn_punc" id = "dis_input_btn_)">)</button>
                	        <button class = "dis_input_btn dis_input_btn_punc" id = "dis_input_btn_-">-</button>
                        </div>
                	</div>
                </div>
                <div class = "dialog_body_line">
                    <div id = "station_list_container" class = "dialog_body_part">
                        <table class = "station_list station_list_title">
                            <tr>
                                <th class = "station_list_title_data">数据源</th>
                                <th class = "station_list_title_name">名称</th>
                                <th class = "station_list_title_value">值</th>
                            </tr>
                        </table>
                        <div class = "station_list_content_container">
                        	<table class = "station_list" id = "station_list_content">
                        		<!-- <tr>
                        			<td class = "station_list_content_data">0320000143</td>
                        			<td class = "station_list_content_name">逆变器N13交流电压</td>
                        			<td class = "station_list_content_value">404.4</td>
                        		</tr>
                        		<tr>
                        			<td class = "station_list_content_data">0320000144</td>
                        			<td class = "station_list_content_name">逆变器N13交流电流</td>
                        			<td class = "station_list_content_value">8.7</td>
                        		</tr>
                                <tr>
                                    <td class = "station_list_content_data">0320000145</td>
                                    <td class = "station_list_content_name">逆变器N14交流电压</td>
                                    <td class = "station_list_content_value">398.1</td>
                                </tr>
                                <tr>
                                    <td class = "station_list_content_data">0320000146</td>
                                    <td class = "station_list_content_name">逆变器N14交流电流</td>
                                    <td class = "station_list_content_value">9.0</td>
                                </tr>
                                <tr>
                                    <td class = "station_list_content_data">0320000147</td>
                                    <td class = "station_list_content_name">逆变器N15交流电压</td>
                                    <td class = "station_list_content_value">400.2</td>
                                </tr>
                                <tr>
                                    <td class = "station_list_content_data">0320000148</td>
                                    <td class = "station_list_content_name">逆变器N15交流电流</td>
                                    <td class = "station_list_content_value">9.2</td>
                                </tr> -->
                        	</table>
                        </div>
                    </div>
                    <div id = "dis_output" class = "dialog_body_part">
                    	<div id = "dis_output_formula" contenteditable = "true" spellcheck = "false" data-value = ""></div>
                    	<div id = "dis_output_result">输出预览：<span id = "dis_output_result_cal">NaN</span></div>
                    </div>
                </div>
            </div>
            <div class = "dialog_bottom">
            	<button class = "dis_operate_btn" id = "dis_operate_btn_cancel">取消</button>
                <button class = "dis_operate_btn" id = "dis_operate_btn_save">保存</button>
            </div>
        </div>
        
    </div>
    <div id = "dv_formula_confirm" class = "dv_formula_confirm" >
            <div class = "dialog_confirm_top">
                确认保存
            </div>
            <div class = "dialog_confirm_body">
                <div class = "dialog_confirm_body_name">
                    <div class = "dialog_confirm_body_name_title">
                        请输入公式名称：
                    </div>
                    <div class = "dialog_confirm_body_name_input">
                        <input type = "text" name = "" id = "confirm_formula_title" spellcheck = "false" />
                    </div>
                </div>
                <div class = "dialog_confirm_body_formula" id = "dialog_confirm_body_formula">

                </div>
            </div>
            <div class = "dialog_confirm_bottom">
                <button class = "dis_operate_btn" id = "confirm_btn_cancel">取消</button>
                <button class = "dis_operate_btn" id = "confirm_btn_save">保存</button>
            </div>
        </div>
</body>
</html>